# 道路建設計画支援システムドキュメント

## 目次

- [システムの概要](#chapter1)
- [実行環境とビルド方法](#chapter2)
- [入力について](#chapter3)
- [基本的な利用方法](#chapter4)
    - [入力ファイルの用意/入力](#chapter4-1)
    - [システムの利用(統合版)](#chapter4-2)
    - [出力の見方](#chapter4-3)
    - [各小課題を解く](#chapter4-4)
- [source/main.pyでの実行](#chapter5)
- [テストデータ生成器について](#chapter6)
- [ビジュアライザの不具合について](#chapter7)

<a id="chapter1"></a>

## システムの概要

本システムでは入力から道路網を構築し, ある地点からある地点への経路探索や新たな地点を適切に追加して道路網の更新等を可能にします.

プログラムのソースは, sourceディレクトリにあります.

``` sh
source
├── Modules
│   ├── input.py
│   ├── manager.py
│   ├── path.py
│   ├── plot.py
│   ├── segments.py
├── main.py
├── main2.py
├── setup.py
├── test.py
└── static
    ├── input.txt
    ├── requirements.txt
    └── testdata
        └── testdataα-β.txt
```

<a id="chapter2"></a>

## 実行環境とビルド方法

実行環境として,

- [Python 3.7.2](https://www.python.org/downloads/release/python-372/)
- Mac OS

を想定します(WindowsやUnixだとプロット図の表示でエラーが発生する可能性が高い).

その他必要なモジュールのインストールは, **setup.py** で行います.

``` sh
$ git clone git@github.com:ie03-aizu-2019/ie03project-skys.git
$ python3 setup.py
```

｢正常にセットアップが完了しました｣と表示されれ, 環境構築は終了です.

<a id="chapter3"></a>

## 入力について
## データの入力について

入力は以下の形式で与えられます
システムの利用にあたり, 道路網を構築するための入力を与える必要があります.

入力形式は以下のように定められています.

``` markup
N M P Q
x1 y1
x2 y2
:
xN yN
b1 e1
b2 e2
:
bM eM
xN+1 yN+1
xN+2 yN+2
:
xN+P yN+P
s1 d1 k1
s2 d2 k2
:
sQ dQ kQ
```

- N: 座標の数
- M: 道の数
- P: 追加される地点の座標の数
- P: 追加する地点の座標の数
- Q: 経路の問い合わせの数

(小課題によっては P や Q は常に 0 に設定されています. )
を1行目に与え, 続いて

続く N 行に地点の x,y 座標が整数で与えられます. xi yi は i 番目の地点の x,y 座標を表します. 続く
M 行に道の情報が与えられます. bi eiは i 番目の道が、地点番号 biと地点番号 eiを結んだ線
分として与えられていることを表します.
続く P 行に追加される地点の x,y 座標が与えられます. xN+i y N+i は i 番目の追加地点の x,y 座
標を表します.
続く Q 行に経路を求める始点と終点が与えられる. si diはそれぞれ i 番目の問い合わせの始
点と終点の地点番号を表し、kiは k 番目までの最短経路について問い合わせていることを表します.
1. 地点の **x, y座標** の情報をN個 (1から順に添え字が振られます)
2. 道の情報を **始点と終点の添字** でM個 (1から順に添え字が振られます)
3. 新たに追加する地点の **x, y座標** をP個
4. 経路の問い合わせを **始点, 終点, 探索数** をQ個

を入力して下さい.

<a id="chapter4"></a>

## 基本的な利用方法

システムの利用方法は,

1. **source/main.py**
2. **source/main2.py**

の2種類が用意されていますが, より分かりやすいmain2.pyを推奨します.
の2種類が用意されていますが, より詳細なmain2.pyを推奨します.

<a id="chapter4-1"></a>

### ① 入力ファイルの用意/入力
システムの利用は, 以下のように行います.

``` sh
$ python3 main2.py <option> <システム番号> <データ番号>
$ cd path/to/source
$ python3 main2.py <option> <機能番号> <データ番号>
```

以下のオプションに対応します
各引数については後述します.

<a id="chapter4-1"></a>

### ① 入力ファイルの用意/入力

\<option> では, 入力方式を指定します.

- -i: 手入力
- -td: 予め用意されたテストデータを使う
- -f: input.txtをテストデータとして使う
- -td: 予め用意されたテストデータ
- -f: 指定されたパスのinput.txtを入力データとして使う

**1. 手入力**

手入力で入力データを渡す場合は, -iオプションで課題番号を渡します.

手入力でシステム1を実行するサンプルは以下の通りです.
手入力で機能1を実行するサンプルは以下の通りです.

``` sh
$ python3 -i 1
4 2 0 0
0 0
5 5
2 5
7 1
1 2
3 4
```

**2. 予め用意されたテストデータを使う**
**2. 予め用意されたテストデータ**

システムの動作確認のため, 予めいくつかのテストデータが用意されています.

テストデータには通常ケース、最小ケース、最大ケース、特殊ケースの4種類があります。
-td オプションを用いることで用意されたテストデータを用いてシステムを使うことができます.

テストデータには通常ケース、最小ケース、最大ケースの3種類と任意個数の特殊ケースが用意されています.

1. 通常
2. 最小
3. 最大
4. 特殊

(特殊ケースが複数ある場合は5から順に番号が振ってあります)
特殊ケースが複数ある場合は4から順に番号が振ってあります.

-td オプションを用いて, 機能2の通常ケースを実行するサンプルは以下の通りです.

-tdオプションを用いてシステム2の通常ケースを実行するサンプルは以下の通りです.
``` sh
$ python3 -td 2 1
3.66667 3.66667
4.86885 2.70492
5.86957 3.26087
```

**3. input.txtをテストデータとして使う**

-fオプションを用いてシステム3を実行するサンプルは以下の通りです.
input.txtを用意します

-f オプションを用いてシステム3を実行するサンプルは以下の通りです.

``` sh
$ python3 main2.py -f 3
7.07107
6.10882
5.88562
NA
2.68432
```
<a id="chapter4-2"></a>

### ② source/main2.py から各小課題を解く

各システム番号が解く課題

1. 2本の線分情報から交差地点を検出する
2. 全ての交差地点を検出する
3. ある地点からある地点の最短距離の距離を出力する
4. 最短経路の経由地点も検出する
5. k番目までの短い経路の距離を検出する
6. k番目までの短い経路の距離とその経由地点を検出する
7. 新たに与えられた地点を最適な線分で道路網に接続し、その交点を出力する
8. 道路網があるとき、どの経路においても通過する道の両端の地点を検出する

以下は、オプションとシステム番号を受け取る部分を抜粋したコードです

```sh
if length == 4:  # test.py, -td, n, case
        if args[1] in ["-td"] and args[2].isdigit and args[3].isdigit:
            # 正常な引数 => 実行
            file = True
            inpath = None
            if args[1] == "-td":
                inpath = path.input_path
            n = int(args[2])
            case = int(args[3])

            result = main2(n, case, file=file, inpath=inpath)
            if result:
                print("プログラムを正常終了します.")
            else:
                print("プログラムを終了します.")
        else:
            # 引数が未定義
            print(f"[ERROR]未定義の引数です.\n{sample}")
    elif length == 3:  # -i, -f
        if args[1] in ["-i","-f"] and args[2].isdigit:
            # 正常な引数 => 実行
            file = True
            inpath = None
            if args[1] == "-i":
                file = False
            if args[1] == "-f":
                inpath = path.input_path
            n = int(args[2])
            result = main2(n, case=None, file=file, inpath=inpath)
            if result:
                print("プログラムを正常終了します.")
            else:
                print("プログラムを終了します.")
        else:
            print(f"[ERROR]未定義の引数です.¥n{sample}")
    else:
        # 引数の長さが異なる
        print(f"[ERROR]引数の数が異なります.\n{sample}")
```

<a id="chapter5"></a>


<a id="chapter6"></a>
### ③ システムの利用(統合版)

``` sh
$ cd path/to/source
$ python3 main2.py -f 9 1
```

を実行することで, システムを利用できます.


システム9の条件分岐について

- P = 0 かつ Q = 0 → システム2、8
- P != 0 → システム7
- Q != 0 → システム6
- P != 0 かつ Q != 0 → システム6,7

<a id="chapter4-3"></a>

### ④ 出力の見方

-fオプションを用いてシステム8の通常ケースを実行するサンプルは以下の通りです.

``` sh
$ python3 main2.py -td 8 1
7 8 0 0
1 3
4 4
2 0
8 3
10 0
11 5
13 2
1 2
1 3
2 3
2 4
4 5
4 6
5 7
6 7

### 小課題8の実行
入力情報を受け取りました(時間: 0.00017095秒)
全交差点を算出しました(時間: 0.00025439秒)
2 4
プログラムの実行が終了しました(時間: 0.00154376秒)
合計時間: 0.00196910秒

### 詳細データ
N(Number of Points)	        	: 7
M(Number of Segments)	      	: 8
P(Number of adding Points)  	: 0
Q(Number of Roots)	         	: 0
-- Points --
1: (1, 3) ['1', '2']
2: (4, 4) ['1', '3', '4']
3: (2, 0) ['2', '3']
4: (8, 3) ['4', '5', '6']
5: (10, 0) ['5', '7']
6: (11, 5) ['6', '8']
7: (13, 2) ['7', '8']
-- Segments --
1: 1(1, 3) -> 2(4, 4) ['1', '2']
2: 1(1, 3) -> 3(2, 0) ['1', '3']
3: 2(4, 4) -> 3(2, 0) ['2', '3']
4: 2(4, 4) -> 4(8, 3) ['2', '4']
5: 4(8, 3) -> 5(10, 0) ['4', '5']
6: 4(8, 3) -> 6(11, 5) ['4', '6']
7: 5(10, 0) -> 7(13, 2) ['5', '7']
8: 6(11, 5) -> 7(13, 2) ['6', '7']
-- Added Points --
-- Roots --

```

<a id="chapter4-4"></a>

## source/main.py の利用
```sh
$ python3 main.py <option> <システム番号>
```
以下のオプションに対応

-i : 手入力

-f : input.txtをテストデータとして使う

-fオプションを用いてシステム8を実行するサンプルは以下の通りです.

``` sh
$ python3 main.py -f 8
2 4
```

詳細データが出力されない点などあるが、大部分の仕様はmain2.pyと同様です。

<a id="chapter6"></a>

## テストデータ生成器

test.pyを用います。実行することでシステム1~8までの最小、最大ケースのテストデータを生成することができます。

``` sh
$ python3 test.py
```

以下の手順でテストデータを生成します。

step1 : N,Mの制約内の最小と最大値で、それぞれ入力例を生成します。(その他の値は制約を満たす乱数)

step2 : 入力用ファイルへ書き込みます

step3 : 各小課題に対応した関数を実行します

step4 : 各フェーズ(入力の取得、全交差地点の算出、各小課題の実行)の実行にかかった時間を測定して表示します

<a id="chapter7"></a>

## プロット不具合

プロットがうまく出来ない場合、matplotlibrcを使用することで問題を解消できる可能性が高いです

matplotlibrcの使用方法
https://matplotlib.org/users/customizing.html
