``` markup
- markupはこしかわへのメモ用に書いてるやつだからこの中に書くなW
- ちゃんと言葉で説明書いてくれ(羅列するんじゃなくて)w
- ソースコード読まずに利用できるように書いてくれw(args[3]とか
    なんやねんて話でしょW)
- markup使うなww
- P=0のとき小課題8 ➜ 小課題番号じゃなくてなにができるのかで書いてくれ(ドキュメント見る側は先生じゃなくて利用者設定よ)
- 出力の見方とか説明書いてくれw 言葉書いてくれW
- だからmarkup使うなてw
- 各小課題を解くのとことか, 小課題とかの前提知識ない前提でドキュメント書いてくれw 交差地点の検出 ➜ 2線分の交差地点を求める みたいに分かるように書いてくれw 10と11は小課題だけど新しい機能ではないし9は③で説明してるから8まででいいよ
- だからmarkup(ry
- main.pyも例くらい載せて一通り説明書いてくれw
- テストデータの作り方とかちゃんと書いてくれw
- だからmarkup使うなって言ってんだろ!!!
- ざっくり構成書いただけだから, 小見出しとか言葉ちゃんとわかるように書き換えてくれーー.
- あとレポートとかコミットじゃないんだら, ちゃんと｢〜修正。｣とかじゃなくてデスマス長で **文章で** かいてくれ!!!!
- あとコンソールの出力書くときくらいはmarkupっぽいやつ使ってもいいけど, shで下みたいに書いて
```

``` sh
$ python3 hello.py
hello world!
```

やりなおし

# 道路建設計画支援システムドキュメント

## 目次

- [システムの概要](#chapter1)
- [実行環境とビルド方法](#chapter2)
- [入力について](#chapter3)
- [基本的な利用方法](#chapter4)
    - [入力ファイルの用意/入力](#chapter4-1)
    - [システムの利用(統合版)](#chapter4-2)
    - [出力の見方](#chapter4-3)
    - [各小課題を解く](#chapter4-4)
- [source/main.pyでの実行](#chapter5)
- [テストデータ生成器について](#chapter6)
- [ビジュアライザの不具合について](#chapter7)

<a id="chapter1"></a>

## システムの概要

本システムでは入力から道路網を構築し, ある地点からある地点への経路探索や新たな地点を適切に追加して道路網の更新等を可能にします.

プログラムのソースは, sourceディレクトリにあります.

``` sh
source
├── Modules
│   ├── input.py
│   ├── manager.py
│   ├── path.py
│   ├── plot.py
│   ├── segments.py
├── main.py
├── main2.py
├── setup.py
├── test.py
└── static
    ├── input.txt
    ├── requirements.txt
    └── testdata
        └── testdataα-β.txt
```

<a id="chapter2"></a>

## 実行環境とビルド方法

実行環境として,

- [Python 3.7.2](https://www.python.org/downloads/release/python-372/)
- Mac OS

を想定します(WindowsやUnixだとプロット図の表示でエラーが発生する可能性が高い).

その他必要なモジュールのインストールは, **setup.py** で行います.

``` sh
$ git clone git@github.com:ie03-aizu-2019/ie03project-skys.git
$ python3 setup.py
```

｢正常にセットアップが完了しました｣と表示されれ, 環境構築は終了です.

<a id="chapter3"></a>

## 入力について

入力は以下の形式で与えられる.

``` markup
N M P Q
x1 y1
x2 y2
:
xN yN
b1 e1
b2 e2
:
bM eM
xN+1 yN+1
xN+2 yN+2
:
xN+P yN+P
s1 d1 k1
s2 d2 k2
:
sQ dQ kQ
```

N-座標の数
M-道の数
P-追加される地点の座標の数
Q-経路の問い合わせの数
(小課題によっては P や Q は常に 0 に設定されている. )

続く N 行に地点の x,y 座標が整数で与えられる. xi yi は i 番目の地点の x,y 座標を表す. 続く
M 行に道の情報が与えられる. bi eiは i 番目の道が、地点番号 biと地点番号 eiを結んだ線
分として与えられていることを表す.
続く P 行に追加される地点の x,y 座標が与えられる. xN+i y N+i は i 番目の追加地点の x,y 座
標を表す.
続く Q 行に経路を求める始点と終点が与えられる. si diはそれぞれ i 番目の問い合わせの始
点と終点の地点番号を表し、kiは k 番目までの最短経路について問い合わせていることを
表す.

<a id="chapter4"></a>

## 基本的な利用方法

システムの利用方法は,

1. **source/main.py**
2. **source/main2.py**

の2種類が用意されていますが, より分かりやすいmain2.pyを推奨します.

<a id="chapter4-1"></a>

### ① 入力ファイルの用意/入力
以下のオプションに対応

-i : 手入力

-td : 予め用意されたテストデータを使う

-f : input.txtをテストデータとして使う

1.**手入力**

手入力で入力データを渡す場合は, -iオプションで課題番号を渡します.

手入力で小課題1を実行するサンプルは以下の通りです.

``` sh
$ python3 -i 1
4 2 0 0
0 0
5 5
2 5
7 1
1 2
3 4
```

2.**予め用意されたテストデータを使う**

テストデータには通常ケース、最小ケース、最大ケース、特殊ケースの4種類がある。
args[3]に入る値でケースを分岐させる。
1-通常
2−最小
3−最大
4-特殊
(特殊ケースが複数ある場合は5から順に番号が振ってある。)

入力、出力の例(小課題2の通常ケース)
``` sh
入力----------------------------
python3 -td 2 1
--------------------------------
出力----------------------------
3.66667 3.66667
4.86885 2.70492
5.86957 3.26087
--------------------------------
```
3.**input.txtをテストデータとして使う**
入力、出力の例(小課題3)
``` sh
入力----------------------------
python3 main2.py -f 3
--------------------------------
出力----------------------------
7.07107
6.10882
5.88562
NA
2.68432
--------------------------------
```



<a id="chapter4-2"></a>

### ② システムの利用(統合版)

``` sh
$ cd path/to/source
$ python3 main2.py -f 9 1
```

を実行することで, システムを利用できます.


小課題9の条件分岐について

- P = 0 かつ Q = 0 → 小課題2、8
- P != 0 → 小課題7
- Q != 0 → 小課題6
- P != 0 かつ Q != 0 → 小課題6,7

<a id="chapter4-3"></a>

### ③ 出力の見方

出力例(小課題8の通常ケース)
```markup
出力例-------------------------------------
7 8 0 0       # 入力値
1 3
4 4
2 0
8 3
10 0
11 5
13 2
1 2
1 3
2 3
2 4
4 5
4 6
5 7
6 7

### 小課題8の実行
入力情報を受け取りました(時間: 0.00017095秒)  # 入力情報を受け取るまでにかかる
全交差点を算出しました(時間: 0.00025439秒) # 全交差地点を算出するまでにかかる時間
2 4
プログラムの実行が終了しました(時間: 0.00154376秒) # プログラムの実行が終了するまでにかかる時間
合計時間: 0.00196910秒

### 詳細データ
N(Number of Points)		: 7
M(Number of Segments)		: 8
P(Number of adding Points)	: 0
Q(Number of Roots)		: 0
-- Points --  # 座標の詳細データ
1: (1, 3) ['1', '2']
2: (4, 4) ['1', '3', '4']
3: (2, 0) ['2', '3']
4: (8, 3) ['4', '5', '6']
5: (10, 0) ['5', '7']
6: (11, 5) ['6', '8']
7: (13, 2) ['7', '8']
-- Segments -- # 線分情報の詳細データ
1: 1(1, 3) -> 2(4, 4) ['1', '2']
2: 1(1, 3) -> 3(2, 0) ['1', '3']
3: 2(4, 4) -> 3(2, 0) ['2', '3']
4: 2(4, 4) -> 4(8, 3) ['2', '4']
5: 4(8, 3) -> 5(10, 0) ['4', '5']
6: 4(8, 3) -> 6(11, 5) ['4', '6']
7: 5(10, 0) -> 7(13, 2) ['5', '7']
8: 6(11, 5) -> 7(13, 2) ['6', '7']
-- Added Points -- # 追加された座標情報の詳細データ
-- Roots -- # 道路網情報の詳細データ

# プロット図の表示

-------------------------------------------
```

<a id="chapter4-4"></a>

### ④ source/main2.py から各小課題を解く

各小課題番号が解く課題

1− 2本の線分情報から交差地点を検出する

2- 任意の数の線分情報から交差地点を全て検出する

3- 任意の数の経路情報からある地点と地点の最短距離を検出する

4- 3の機能に加えて最短経路の経由地点も検出する

5- 3の機能に加えてk番目までの短い経路の距離を検出する

6- 5の機能に加えて経由地点も検出する

7- 新たに与えられた地点情報と既存の線分情報を結ぶ最短の道を検出し、その交点を求める

8- 任意の数の経路情報から幹線道路の両端の地点を検出する

以下は、オプションと小課題番号を受け取る部分を抜粋したコードである

※小課題番号の指定はどの入力方法でもargs[2]でおこなう
```sh
if length == 4:  # test.py, -td, n, case
        if args[1] in ["-td"] and args[2].isdigit and args[3].isdigit:
            # 正常な引数 => 実行
            file = True
            inpath = None
            if args[1] == "-td":
                inpath = path.input_path
            n = int(args[2])
            case = int(args[3])

            result = main2(n, case, file=file, inpath=inpath)
            if result:
                print("プログラムを正常終了します.")
            else:
                print("プログラムを終了します.")
        else:
            # 引数が未定義
            print(f"[ERROR]未定義の引数です.\n{sample}")
    elif length == 3:  # -i, -f
        if args[1] in ["-i","-f"] and args[2].isdigit:
            # 正常な引数 => 実行
            file = True
            inpath = None
            if args[1] == "-i":
                file = False
            if args[1] == "-f":
                inpath = path.input_path
            n = int(args[2])
            result = main2(n, case=None, file=file, inpath=inpath)
            if result:
                print("プログラムを正常終了します.")
            else:
                print("プログラムを終了します.")
        else:
            print(f"[ERROR]未定義の引数です.¥n{sample}")
    else:
        # 引数の長さが異なる
        print(f"[ERROR]引数の数が異なります.\n{sample}")
```

<a id="chapter5"></a>

## source/main.py の利用

以下のオプションに対応

-i : 手入力

-f : input.txtをテストデータとして使う

入力、出力の例(小課題8)
``` sh
入力----------------------------
python3 main.py -f 8
--------------------------------
出力----------------------------
2 4
--------------------------------
```


詳細データが出力されない点などあるが、大部分の仕様はmain2.pyと同様である。


<a id="chapter6"></a>

## テストデータ生成器

test.pyを用いる。以下の手順で最小、最大ケースを生成。

step1 : N,Mの制約内の最小と最大値で、それぞれ入力例を生成する。(その他の値は制約を満たす乱数)

step2 : 入力用ファイルへ書き込む

step3 : 各小課題に対応した関数を実行

step4 : 各フェーズ(入力の取得、全交差地点の算出、各小課題の実行)の実行にかかった時間を測定して表示する。

<a id="chapter7"></a>

## プロット不具合

プロットがうまく出来ない場合、matplotlibrcを使用することで解消できる可能性が高い

matplotlibrcの使用方法 :
https://matplotlib.org/users/customizing.html
