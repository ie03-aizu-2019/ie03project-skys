# 道路建設計画支援システムドキュメント

## 目次

- [システムの概要](#chapter1)
- [実行環境とビルド方法](#chapter2)
- [データの入力について](#chapter3)
- [基本的な利用方法](#chapter4)
    - [入力ファイルの用意/入力](#chapter4-1)
    - [システムが提供する機能](#chapter4-2)
    - [システムの利用(統合版)](#chapter4-3)
    - [出力の確認](#chapter4-4)
- [main.pyでの実行](#chapter5)
- [テストデータ生成器](#chapter6)
- [図のプロットに失敗す場合](#chapter7)

<a id="chapter1"></a>

## システムの概要

本システムでは入力から道路網を構築し, ある地点からある地点への経路探索や新たな地点を適切に追加して道路網の更新等を可能にします.

プログラムのソースは, sourceディレクトリにあります.

``` sh
source
├── Modules
│   ├── input.py
│   ├── manager.py
│   ├── path.py
│   ├── plot.py
│   ├── segments.py
├── main.py
├── main2.py
├── setup.py
├── test.py
└── static
    ├── input.txt
    ├── requirements.txt
    └── testdata
        └── testdataα-β.txt
```

<a id="chapter2"></a>

## 実行環境とビルド方法

実行環境として,

- [Python 3.7.2](https://www.python.org/downloads/release/python-372/)
- Mac OS

を想定します(WindowsやUnixだとプロット図の表示でエラーが発生する可能性が高いですが, それ以外の機能は問題なく使えます).

その他必要なモジュールのインストールは, **setup.py** で行います.

``` sh
$ git clone git@github.com:ie03-aizu-2019/ie03project-skys.git
$ python3 setup.py
```

｢正常にセットアップが完了しました｣と表示されれば, 環境構築は終了です.

<a id="chapter3"></a>

## データの入力について

システムの利用にあたり, 道路網を構築するための入力を与える必要があります.

入力形式は以下のように定められています.

``` markup
N M P Q
x1 y1
x2 y2
:
xN yN
b1 e1
b2 e2
:
bM eM
xN+1 yN+1
xN+2 yN+2
:
xN+P yN+P
s1 d1 k1
s2 d2 k2
:
sQ dQ kQ
```

- N: 座標の数
- M: 道の数
- P: 追加する地点の座標の数
- Q: 経路の問い合わせの数

を1行目に与え, 続いて

1. 地点の **x, y座標** の情報をN個 (1から順に添え字が振られます)
2. 道の情報を **始点と終点の添字** でM個 (1から順に添え字が振られます)
3. 新たに追加する地点の **x, y座標** をP個
4. 経路の問い合わせを **始点, 終点, 探索数** をQ個

を入力して下さい.

<a id="chapter4"></a>

## 基本的な利用方法

システムの利用方法は,

1. **source/main.py**
2. **source/main2.py**

の2種類が用意されていますが, より詳細なmain2.pyを推奨します.

システムの利用は, 以下のように行います.

``` sh
$ cd path/to/source
$ python3 main2.py <option> <機能番号> <データ番号>
```

引数については,

| オプション | 内容 |
| --- | --- |
| \<option> | -i / -td / -f |
| <機能番号> | 1 〜 8 |
| <データ番号> | 1 〜 4 + α |

図のようになっています.

optionではデータ入力の方式( それぞれ 手入力, 用意されたテストデータから入力, ファイル入力 )を指定し,

機能番号と, テストデータから入力する場合はデータ番号も引数として渡します.

より詳しくは後述します.

<a id="chapter4-1"></a>

### ① 入力ファイルの用意/入力

\<option> では, 入力方式を指定します.

- -i: 手入力
- -td: 予め用意されたテストデータ
- -f: ファイル入力

**1. 手入力**

手入力で入力データを渡す場合は, -iオプションで課題番号を渡します.

手入力で機能1を実行するサンプルは以下の通りです.

``` sh
$ python3 -i 1
4 2 0 0
0 0
5 5
2 5
7 1
1 2
3 4
```

**2. 予め用意されたテストデータ**

システムの動作確認のため, 予めいくつかのテストデータが用意されています.

-td オプションを用いることで用意されたテストデータを用いてシステムを使うことができます.

テストデータには通常ケース、最小ケース、最大ケースの3種類と任意個数の特殊ケースが用意されています.

1. 通常
2. 最小
3. 最大
4. 特殊

特殊ケースが複数ある場合は4から順に番号が振ってあります.

-td オプションを用いて, 機能1の通常ケースを実行するサンプルは以下の通りです.

``` sh
$ python3 -td 1 1
```

**3. ファイル入力**

**source/static/input.txt** に入力データを書き込んでおいて, -f オプションでシステムを起動することでファイルから入力を渡すことができます.

-f オプションを用いてシステム1を実行するサンプルは以下の通りです.

``` sh
$ python3 main2.py -f 1
```
<a id="chapter4-2"></a>

### ② システムが提供する機能

このシステムでは以下の8種類の機能と, その統合機能を利用することができます.

1. 2本の線分情報から交差地点を検出する
2. 全ての交差地点を検出する
3. ある地点からある地点の最短距離の距離を出力する
4. 最短経路の経由地点も検出する
5. k番目までの短い経路の距離を検出する
6. k番目までの短い経路の距離とその経由地点を検出する
7. 新たに与えられた地点を最適な線分で道路網に接続し、その交点を出力する
8. 幹線道路の検出と出力

※幹線道路とは, 任意の地点から任意の地点へ向かうときに必ず通る道のことを指します.


<a id="chapter4-3"></a>

### ③ システムの利用(統合版)

システムでは, 入力に応じて適切な機能を実行する統合版の機能も利用できます.

利用には, 機能番号として9を渡します.

具体的には,

- P = 0 かつ Q = 0 → 機能2, 8
- P != 0 → 機能7
- Q != 0 → 機能6
- P != 0 かつ Q != 0 → 機能6, 7

が実行されます.

例)

``` sh
$ python3 main2.py -f 9
```

<a id="chapter4-4"></a>

### ④ 出力の確認

main2.pyからシステムを利用すると以下のような出力とプロット図が表示されます.

``` sh
$ python3 main2.py -td 8 1
7 8 0 0
1 3
4 4
2 0
8 3
10 0
11 5
13 2
1 2
1 3
2 3
2 4
4 5
4 6
5 7
6 7

### 小課題8の実行
入力情報を受け取りました(時間: 0.00017095秒)
全交差点を算出しました(時間: 0.00025439秒)
2 4
プログラムの実行が終了しました(時間: 0.00154376秒)
合計時間: 0.00196910秒

### 詳細データ
N(Number of Points)	        	: 7
M(Number of Segments)	      	: 8
P(Number of adding Points)  	: 0
Q(Number of Roots)	         	: 0
-- Points --
1: (1, 3) ['1', '2']
2: (4, 4) ['1', '3', '4']
3: (2, 0) ['2', '3']
4: (8, 3) ['4', '5', '6']
5: (10, 0) ['5', '7']
6: (11, 5) ['6', '8']
7: (13, 2) ['7', '8']
-- Segments --
1: 1(1, 3) -> 2(4, 4) ['1', '2']
2: 1(1, 3) -> 3(2, 0) ['1', '3']
3: 2(4, 4) -> 3(2, 0) ['2', '3']
4: 2(4, 4) -> 4(8, 3) ['2', '4']
5: 4(8, 3) -> 5(10, 0) ['4', '5']
6: 4(8, 3) -> 6(11, 5) ['4', '6']
7: 5(10, 0) -> 7(13, 2) ['5', '7']
8: 6(11, 5) -> 7(13, 2) ['6', '7']
-- Added Points --
-- Roots --
```

出力は,

1. 実行フェーズ(システムの出力と実行時間)
2. 詳細フェーズ

に大別され, 詳細フェーズでは

- 入力されたN, M, P, Qの値
- 地点情報 -> 添字: (x, y) \[接線1, 接線2, ...]
- 道情報 -> 始点 -> 終点 \[接点1, 接点2, ...]
- 追加点
- 経路情報

が出力されます.

<a id="chapter5"></a>

## source/main.py の利用

出力を簡易化した main.pyも利用できます.

使い方は以下のとおりです.

```sh
$ python3 main.py <option> <システム番号>
```

オプションは,

- -i : 手入力
- -f : ファイル入力

で, 基本的な使い方は main2.pyと同様です.

-f オプションを用いてシステム1を実行するサンプルは以下の通りです.

``` sh
$ python3 main.py -f 8
```

<a id="chapter6"></a>

## テストデータ生成器

テストデータジェネレータ(test.py)を使うことで, システムが受け取れる最大入力と最小入力のテストデータを生成することができます.

``` sh
$ python3 test.py
```

以上を実行することで, 自動的に全機能用のテストデータが作成されます.

<a id="chapter7"></a>

## 図のプロットに失敗する場合

GUIバックエンドの関係で, 図がプロットできない場合があります.

その場合は、matplotlibrcを適切に修正することで対処できる可能性があります.

参考: [matplotlib](https://matplotlib.org/users/customizing.html)
